{% extends "base.html" %}
{% load humanize %}
{% load bootstrap %}
{% load markdown %}

{% block title %}{{ post.title }} | Charcha{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="post">
      <div data-object-type="posts" data-object-id="{{post.id}}" class="vote-control">
        <div data-state="enabled" class="vote-button upvote"></div>
        <div data-state="enabled" class="vote-button downvote"></div>
      </div>
      <div>
          <div class="post-title">
            <h2>{{ post.title }}</h2>
          </div>
          <div class="post-line-2">
            <div class="post-score">
               by {{ post.author.username }} | 
              {{ post.score }} points | 
              {{ comments|length }} comment{{ comments | length | pluralize }} |
              {{ post.submission_time | naturaltime }}
            </div>
          </div>
          {% if post.text %}
          <div class="post-text">
            <p>{{post.text | markdown}}</p>
          </div>
          {% endif %}
          <form method="post" action="">
            {% csrf_token %}
            {{ form | bootstrap }}
            <button type="submit" class="btn btn-default">Add Comment</button>
          </form>
      </div>
  </div>
  <div class="comments">
  {% for comment in comments %}
    <div class="comment indent-{{comment.indent}}">
      <div data-object-type="comments" data-object-id="{{comment.id}}" class="vote-control">
        {% if comment.is_upvoted and comment.is_downvoted %}
        <button class="vote-button upvote" data-state="voted"></button>
        <button class="vote-button downvote" data-state="voted"></button>
        {% elif comment.is_upvoted %}
        <button class="vote-button upvote" data-state="voted"></button>
        <button class="vote-button downvote" data-state="disabled"></button>
        {% elif comment.is_downvoted %}
        <button class="vote-button upvote" data-state="disabled"></button>
        <button class="vote-button downvote" data-state="voted"></button>
        {% else %}
        <button class="vote-button upvote" data-state="enabled"></button>
        <button class="vote-button downvote" data-state="enabled"></button>
        {% endif %}
      </div>
      <div>
        <div class="comment-header">
          <span class="comment-author">
            by {{ comment.author.username }}
          </span>
          <span>|</span>
          <span>{{comment.score}} points</span>
          <span>|</span>
          <span class="comment-submission-time">{{ comment.submission_time | naturaltime }}</span>
        </div>
        <div class="comment-text">
          <p>
              {{ comment.text | markdown}}
          </p>
        </div>
        {% if comment.indent < 6 %}
        <a class="reply" href="{% url 'reply_to_comment' comment.id %}">reply</a>
        {% else %}
        <span><i>replies not allowed anymore</i></span>
        {% endif %}
      </div>
    </div>
  {% endfor %}
 </div>
</div>
{% endblock %}
